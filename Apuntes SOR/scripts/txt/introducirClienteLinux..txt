#!/bin/bash

##################################################
##	 INTRODUCIR CLIENTE UBUNTU EN DOMINIO	##
##		Hecho por Radek			##
##################################################
##
#####################
#¡EJECUTAR CON ROOT!#
#####################


HOSTNAME=$(hostname)
echo "Introduce tu dominio en minúsculas  (sin extensión; por ejemplo, iesallerrl )"
read DOMINIOMIN

DOMINIOMAS=$(echo "$DOMINIOMIN" | tr '[:lower:]' '[:upper:]')

#Actualizar paquetes
apt update

# Instalación y configuración del servicio NTP
apt install ntp -y
sed -i '0,/pool 0./s/pool .*/server 0.es.pool.ntp.org/; 0,/pool 1./s/pool .*/server 1.es.pool.ntp.org/; 0,/pool 2./s/pool .*/server 2.es.pool.ntp.org/; 0,/pool 3./s/pool .*/server 3.es.pool.ntp.org/' /etc/ntp.conf
systemctl restart ntp.service
sleep 2
ntpq -p
echo "Servicio NTP instalado y configurado correctamente!"
sleep 1



#Configurar fichero /etc/hosts
sed -i "s/127.0.1.1.*/127.0.1.1 $HOSTNAME/g" /etc/hosts
echo "Hosts configurados correctamente"
sleep 1


#Configurar search
nmcli connection modify "Conexión cableada 1" ipv4.dns-search "$DOMINIOMAS.LOCAL"
echo "nameserver 127.0.0.53" > /etc/resolv.conf
echo "options edns0 trust-ad" >> /etc/resolv.conf
echo "search $DOMINIOMAS.LOCAL" >> /etc/resolv.conf





sleep 1

#Descargar e instalar pbis-open
wget -O pbis-installer.sh https://github.com/BeyondTrust/pbis-open/releases/download/9.1.0/pbis-open-9.1.0.551.linux.x86_64.deb.sh
sleep 5
sh pbis-installer.sh

#Unirse a dominio
domainjoin-cli join --disable ssh  $DOMINIOMAS.LOCAL Administrator --password=abc123.








